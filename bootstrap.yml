---
- hosts: all
  become: yes
  become_user: root

  vars:
    DEFAULT_PACKAGES:
      - ufw
      - fail2ban

  tasks:
    - include_vars: secrets.yml
    - include: playbooks/_base.yml
    - include: playbooks/admin.yml
    - include: playbooks/ufw.yml
    - include: playbooks/ssh.yml
    - include: playbooks/unattended-upgrades.yml

    - name: install extra packages defined in secrets.yml
      apt: state=present pkg={{ EXTRA_PACKAGES|default([]) }}

  handlers:
    - name: restart ssh
      service: name=ssh state=restarted
